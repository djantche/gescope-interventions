{% extends 'base.html.twig' %}
{% block title %}Liste des interventions{% endblock %}

{% block body %}
<div class="container">
  <div class="toolbar">
    <a class="btn" href="{{ path('intervention_new') }}">‚ûï Nouvelle intervention</a>

    <form method="get" class="filter">
      <select name="technician">
        <option value="">-- Technicien --</option>
        {% for t in technicians %}
          <option value="{{ t }}" {{ currentTechnician==t ? 'selected' : '' }}>{{ t }}</option>
        {% endfor %}
      </select>

      <select name="status">
        <option value="">-- √âtat --</option>
        <option value="en cours" {{ currentStatus=='en cours' ? 'selected' : '' }}>En cours</option>
        <option value="valid√©e" {{ currentStatus=='valid√©e' ? 'selected' : '' }}>Valid√©e</option>
        <option value="termin√©e" {{ currentStatus=='termin√©e' ? 'selected' : '' }}>Termin√©e</option>
        <option value="annul√©e" {{ currentStatus=='annul√©e' ? 'selected' : '' }}>Annul√©e</option>
      </select>

      <button class="btn small" type="submit">Filtrer</button>
    </form>
  </div>

  <div class="ticket-list">
    {% for i in interventions %}
      <div class="ticket">
        <div class="ticket-header">
          <span class="ticket-ref">{{ i.reference }}</span>
          <span class="ticket-status {{ i.status }}">{{ i.status }}</span>
        </div>
        <p><strong>Client :</strong> {{ i.firstName }} {{ i.lastName }}</p>
        <p><strong>Date :</strong> {{ i.scheduledAt ? i.scheduledAt|date('d/m/Y H:i') : '' }}</p>
        <p><strong>Technicien :</strong> {{ i.technician }}</p>
        <div class="ticket-actions">
          <a class="btn small" href="{{ path('intervention_show', {'id': i.id}) }}">üëÅ Voir</a>
          <form method="post" action="{{ path('intervention_change_status', {'id': i.id}) }}">
            <select name="status">
              <option value="en cours">En cours</option>
              <option value="valid√©e">Valid√©e</option>
              <option value="termin√©e">Termin√©e</option>
              <option value="annul√©e">Annul√©e</option>
            </select>
            <button class="btn small" type="submit">Mettre √† jour</button>
          </form>
        </div>
      </div>
    {% else %}
      <p>Aucune intervention trouv√©e.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
